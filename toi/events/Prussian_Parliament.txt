add_namespace = prussian_votes
add_namespace = prussian_votes_results

#Vote on Expanding Voting Rights
country_event = {
	id = prussian_votes.1
	title = prussian_votes.1.t
	desc = prussian_votes.1.d
	picture = GFX_event_prussian_parliament_king

	is_triggered_only = yes

	immediate = {
		set_variable = { 
			var = current_reform_id
			value = 17.6    
		}

		reset_approval_arrays = yes 
		set_1_approval_highly_disagree = yes 
		set_2_approval_highly_disagree = yes 
		set_3_approval_highly_agree = yes 
		set_4_approval_highly_agree = yes 

		set_vote_cul = yes
		compute_voting_approval = yes

		compute_number_seats_tot = yes 
		compute_number_seats_approve_est = yes
	}

	option = { # Let's vote in a month
		name = prussian_votes.1.a
		ai_chance = { factor = 100 }
		
		country_event = {
			id = prussian_votes_results.1
			days = 31 
		}
	}

	option = { # Abandon the idea
		name = prussian_votes.1.b
		ai_chance = { factor = 0 }
		
		add_political_power = -50
		add_stability = -0.05
		if = {
			limit = {
				has_government = traditional_conservatism
			}
			add_popularity = { ideology = traditional_conservatism popularity = -0.05 }
		}
		if = {
			limit = {
				has_government = centrism
			}
			add_popularity = { ideology = centrism popularity = -0.05 }
		}
		
		set_variable = { 
			var = current_reform_id
			value = 0
		}
	}
}

#Results of Vote on Expanding Voting Rights
country_event = {
	id = prussian_votes_results.1
	title = prussian_votes_results.1.t
	desc = prussian_votes_results.1.d
	picture = GFX_event_prussian_parliament_king

	is_triggered_only = yes

	immediate = {
		hidden_effect = {
			calculate_vote_result = yes
		}
	}

	option = { # It's a success !
		name = prussian_votes_results.1.a
		trigger = {
			has_country_flag = eoanb_reform_vote_success
		}
		clr_country_flag = eoanb_reform_vote_success
		enact_voted_reform = yes
		
		PRS = {
			if = {
				limit = {
					PRS = { has_idea = absolutism }
				}
				swap_ideas = { remove_idea = absolutism add_idea = parliamentary_suffrage }
			}
			else_if = {
				limit = {
					PRS = { has_idea = parliamentary_suffrage }
				}
				swap_ideas = { remove_idea = parliamentary_suffrage add_idea = universal_male_suffrage }
			}
		}
		
		PRS = {
			if = {
				limit = {
					has_government = traditional_conservatism
				}
				add_popularity = { ideology = traditional_conservatism popularity = -0.01 }
				add_popularity = { ideology = centrism popularity = 0.01 }
			}
			if = {
				limit = {
					has_government = centrism
				}
				add_popularity = { ideology = traditional_conservatism popularity = 0.01 }
				add_popularity = { ideology = centrism popularity = -0.01 }
			}
		}
		
		set_variable = { 
			var = current_reform_id
			value = 0
		}
    }

	option = { # It's a failure...
		name = prussian_votes_results.1.b
		trigger = {
			has_country_flag = eoanb_reform_vote_failure
		}
		clr_country_flag = eoanb_reform_vote_failure

		PRS = {
			add_political_power = -50
			if = {
				limit = {
					has_government = traditional_conservatism
				}
				add_popularity = { ideology = traditional_conservatism popularity = -0.01 }
				add_popularity = { ideology = centrism popularity = 0.01 }
			}
			if = {
				limit = {
					has_government = centrism
				}
				add_popularity = { ideology = traditional_conservatism popularity = 0.01 }
				add_popularity = { ideology = centrism popularity = -0.01 }
			}
		}
		
		set_variable = { 
			var = current_reform_id
			value = 0
		}
    }

	option = { # This is somehow worse than a failure
		name = prussian_votes_results.1.c
		trigger = {
			has_country_flag = eoanb_reform_vote_tie
		}
		clr_country_flag = eoanb_reform_vote_tie
		
		add_political_power = -25
		PRS = { country_event = { id = prussian_votes.1 days = 14 } }
	}
}